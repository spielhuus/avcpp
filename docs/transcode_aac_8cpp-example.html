<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>avcpp: transcode_aac.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">avcpp
   &#160;<span id="projectnumber">0.2.6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">transcode_aac.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>transcode audio data and write aac result to file.</p><pre>Usage: transcode_aac &lt;input file&gt; &lt;output file&gt;</pre><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;../av/format.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;../av/resample.h&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[]) {</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (argc &lt;= 2) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;Usage: %s &lt;input file&gt; &lt;output file&gt;\n&quot;</span>, argv[0]);</div><div class="line">        exit(0);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a name="_a0"></a><a class="code" href="classav_1_1_format.html">av::Format</a> format( argv[1] );</div><div class="line">    <span class="keyword">auto</span> metadata_ = format.<a name="a1"></a><a class="code" href="classav_1_1_format.html#a78b9612b0b7d961674a6848da01bae3b">metadata</a>();</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Decode: &quot;</span> &lt;&lt; argv[1] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt;</div><div class="line">                 <span class="stringliteral">&quot;playtime: &quot;</span> &lt;&lt; format.<a name="a2"></a><a class="code" href="classav_1_1_format.html#ad8db94ee2895b63e7934bec575bca1da">playtime</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt;</div><div class="line">                  metadata_ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"></div><div class="line">    <span class="keyword">auto</span> _codec = std::find_if( format.<a name="a3"></a><a class="code" href="classav_1_1_format.html#adf8c18475c1f5d048e74421c5e7873d9">begin</a>(), format.<a name="a4"></a><a class="code" href="classav_1_1_format.html#ad66c53307fc2f03bac49d1d96be2a9ef">end</a>(), <a name="a5"></a><a class="code" href="namespaceav.html#a8f05434b199e41f7262b9de00abfe590">av::is_audio</a> );</div><div class="line">    std::cout &lt;&lt; *(*_codec) &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <a name="_a6"></a><a class="code" href="classav_1_1_codec.html">av::Codec</a> _target_codec( av::Codec::ID::AAC, <a name="a7"></a><a class="code" href="namespaceav.html#ae593d8406e0f3102fcbfd5ee8931d6c1a98ff3f1ca76b08e104c36d48e16f525a">av::SampleFormat::SAMPLE_FMT_FLTP</a>, <a name="_a8"></a><a class="code" href="classav_1_1_options.html">av::Options</a>( { { <span class="stringliteral">&quot;ar&quot;</span>, 44100 }, {<span class="stringliteral">&quot;ac&quot;</span>, 2}, {<span class="stringliteral">&quot;b&quot;</span>, 96000} } ) );</div><div class="line">    std::cout &lt;&lt; _target_codec &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <a name="_a9"></a><a class="code" href="classav_1_1_resample.html">av::Resample</a> _resampler(</div><div class="line">        (*_codec)-&gt;channel_layout(), (*_codec)-&gt;sample_fmt(), (*_codec)-&gt;sample_rate(),</div><div class="line">        _target_codec.<a name="a10"></a><a class="code" href="classav_1_1_codec.html#a38d2e8e98a352465ecff550f1536920a">channel_layout</a>(), _target_codec.<a name="a11"></a><a class="code" href="classav_1_1_codec.html#afb04f2ba584a81de4bd0c9669d9477cf">sample_fmt</a>(), _target_codec.<a name="a12"></a><a class="code" href="classav_1_1_codec.html#a0385fa9664325c6f68e9089ed9d87ce9">sample_rate</a>() );</div><div class="line"></div><div class="line">    <a class="code" href="classav_1_1_format.html">av::Format</a> target_format( argv[2], <a name="a13"></a><a class="code" href="classav_1_1_format.html#aa2b5fe128c6490b54ffe74425160c06aa5b4a046b3b59617d724b25110d4999ab">av::Format::WRITE</a> );</div><div class="line">    target_format.add_encoder( _target_codec );</div><div class="line"></div><div class="line">    std::error_code errc = format.<a name="a14"></a><a class="code" href="classav_1_1_format.html#a868c2f2408deab4d0fc0c4fab0e74c22">read</a>( [&amp;]( <a name="_a15"></a><a class="code" href="structav_1_1_packet.html">av::Packet</a>&amp; package ) {</div><div class="line">        <span class="keywordflow">if</span>( package.stream_index() == (*_codec)-&gt;index() ) {</div><div class="line"><span class="comment">//            std::cout &lt;&lt; &quot;read pcakage:&quot; &lt;&lt; errc.value() &lt;&lt; std::endl;</span></div><div class="line">            std::error_code errc_decode = (*_codec)-&gt;decode( package, [&amp;]( <a name="_a16"></a><a class="code" href="classav_1_1_frame.html">av::Frame</a>&amp; frame ) {</div><div class="line"><span class="comment">//            std::cout &lt;&lt; &quot;decode frame&quot; &lt;&lt; frame.nb_samples() &lt;&lt; std::endl;</span></div><div class="line">                <span class="comment">//transcode frame</span></div><div class="line">                errc = _resampler.resample( frame, 1024 <span class="comment">/*frame.nb_samples()*/</span>, [&amp;]( <a class="code" href="classav_1_1_frame.html">av::Frame</a>&amp; resampled_frame ) {</div><div class="line"><span class="comment">//            std::cout &lt;&lt; &quot;resample frame&quot; &lt;&lt; std::endl;</span></div><div class="line">                    errc = _target_codec.<a name="a17"></a><a class="code" href="classav_1_1_codec.html#ae36a8537b14bba607550872aa22b046d">encode</a>( resampled_frame, [&amp;]( <a class="code" href="structav_1_1_packet.html">av::Packet</a>&amp; package ) {</div><div class="line"><span class="comment">//            std::cout &lt;&lt; &quot;write package&quot; &lt;&lt; std::endl;</span></div><div class="line">                       target_format.write( package );</div><div class="line">                    });</div><div class="line"><span class="comment">//    std::cout &lt;&lt; &quot;resample errc: &quot; &lt;&lt; errc.message() &lt;&lt; std::endl;</span></div><div class="line">                });</div><div class="line">            });</div><div class="line">        }</div><div class="line">    });</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;=&quot;</span> &lt;&lt; errc.message() &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 1 2018 14:10:02 for avcpp by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
